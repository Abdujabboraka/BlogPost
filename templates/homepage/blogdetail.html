{% extends 'base.html' %}
{% load static %}
{% block category %}
{% for cg in categories %}
<a href="{% url 'category_detail' cg.slug %}" class="hover:text-indigo-500">{{ cg.name }}</a>
{% endfor %}
{% endblock %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<article class="max-w-3xl mx-auto py-10 px-4">
  <div class="bg-white shadow-md rounded-2xl overflow-hidden">
    {% if blog.photo %}
    <img src="{{ blog.photo.url }}" alt="{{ blog.title }}" class="w-full h-72 object-cover">
    {% endif %}

    <div class="p-6">
      <h1 class="text-3xl font-bold mb-3 text-gray-800">{{ blog.title }}</h1>
      <div class="flex justify-between text-sm text-gray-500 mb-4">

          {% if request.user.profile == blog.owner.user %}
          You
          {% else %}
        <span>By @{{ blog.owner.user.username }}</span>
          {% endif %}
          <span>{{ blog.created_at|date:"M d, Y" }}</span>
      </div>
      <p class="text-gray-700 leading-relaxed mb-6">{{ blog.description }}</p>

        <div style=" display: flex; justify-content: space-between; align-items: center; ">


      <!-- Like Button -->
        {% if request.user.is_authenticated %}
      <form action="{% url 'like_blog' blog.link %}" method="POST" class="mb-6">
        {% csrf_token %}
        <button class=" hover:bg-indigo-100 text-white  rounded-lg shadow-md transition">
           <p class="text-3xl mb-3 text-gray-800">üëç<span style="font-size: 18px;">{{ blog.likes }}</span></p>
        </button>
      </form>
        {% else %}
         <p class="text-3xl mb-3 text-gray-800">üëç<span style="font-size: 18px;">{{ blog.likes }}</span></p>
        {% endif %}

<!--    share elements-->
  <div class="share-container">
  <button class="share-btn">üîó Share</button>
  <div class="share-options">
       <p class="link-copy_text">{{ share_url }}</p>
    <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_url }}" target="_blank" class="fab fa-facebook"></a>
    <a href="https://twitter.com/intent/tweet?url={{ share_url }}" target="_blank" class="fab fa-whatsapp">Twitter</a>
    <a href="https://t.me/share/url?url={{ share_url }}" target="_blank" class="fab fa-telegram">Telegram</a>
    <a href="https://api.whatsapp.com/send?text={{ share_url }}" target="_blank" class="fab fa-whatsapp">WhatsApp</a>
    <button class="copy-btn" onclick="copyShareLink('{{ share_url }}')">Copy Link</button>

  </div>
</div>
</div>
 <hr class="my-6">
    <style>


.share-container {
  position: relative;
  z-index: 9999;
  transition: 2s;
}
.link-copy_text {
font-size: 12px;
}

.share-btn {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 15px;
  transition: 1s;
}

.share-btn:hover {
  background-color: #0056b3;
  transition: 5s;
}

.share-options {
  display: none;
  position: absolute;
  top: 110%;
  right: 0;
  background: white;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 8px;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
  z-index: 999999;
  transition: 2s;
}

.share-container:hover .share-options {
  display: block;

}


.share-options a,
.copy-btn {
  display: block;
  color: #333;
  text-decoration: none;
  padding: 6px 8px;
  border-radius: 5px;
  transition: background 0.2s;
  text-align: left;
  background: none;
  border: none;
  width: 100%;
  cursor: pointer;
}

.share-options a:hover,
.copy-btn:hover {
  background: #f0f0f0;
  transition: 2s;
}
</style>


<!--    share elements-->
      <!-- Comments -->
      <h3 class="text-2xl font-semibold mb-4">Comments ({{ blog.comments.count }})</h3>
      <div class="space-y-4">
        {% for comment in blog.comments.all %}
        <div class="bg-gray-50 p-3 rounded-lg shadow-sm">
            <small class="text-gray-500"><a class="text-blue-500" href="#">

                {% if request.user.profile == comment.user %}
                you
                {% else %}
                @{{ comment.user.username }}
                {% endif %}
            </a> on {{ comment.created_at|date:"M d, Y" }}</small>
          <p class="text-gray-800">{{ comment.comment }}</p>
        </div>
        {% empty %}
        <p class="text-gray-500">No comments yet. Be the first!</p>
        {% endfor %}
      </div>

      <!-- Add Comment -->
        {% if request.user.is_authenticated %}
      <form action="{% url 'add_comment' blog.link %}" method="POST" class="mt-6">
        {% csrf_token %}
        <textarea name="comment" rows="1" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-indigo-400" placeholder="Write your comment..."></textarea>
        <button type="submit" class="mt-3 bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg">Post Comment</button>
      </form>
        {% endif %}
    </div>
  </div>
</article>


<script>
function copyShareLink(link) {
  navigator.clipboard.writeText(link).then(() => {
    alert("‚úÖ Link copied to clipboard!");
  }).catch(() => {
    alert("‚ùå Failed to copy link. Please try again.");
  });
}
</script>
{% endblock %}
